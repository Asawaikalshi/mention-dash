<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalshi Mentions</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Kalshi Mentions</h1>
        </header>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <div class="upload-area" id="uploadArea">
                <input type="file" id="fileInput" accept="video/*,audio/*" hidden>
                <div class="upload-content">
                    <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <h3>Drop your video here</h3>
                    <p>or click to browse</p>
                    <span class="file-types">Supports MP4, MOV, AVI, MKV, MP3, WAV (max 10GB)</span>
                </div>
                <div class="selected-file" id="selectedFile" style="display: none;">
                    <svg class="file-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    <div class="file-details">
                        <div class="file-name" id="fileName"></div>
                        <div class="file-size" id="fileSize"></div>
                    </div>
                    <button class="btn-remove" id="removeBtn">✕</button>
                </div>
            </div>

            <button class="btn-primary" id="transcribeBtn" disabled>
                <span id="btnText">Upload & Transcribe</span>
                <div class="spinner" id="spinner" style="display: none;"></div>
            </button>
        </div>

        <!-- Progress Section -->
        <div class="progress-section" id="progressSection" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">Uploading...</p>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <h2>Transcription Results</h2>
                <div class="results-actions">
                    <button class="btn-secondary" id="downloadBtn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Download JSON
                    </button>
                    <button class="btn-secondary" id="newBtn">New Transcription</button>
                </div>
            </div>

            <div class="results-meta" id="resultsMeta"></div>

            <!-- Keyword Search Section -->
            <div class="keyword-search-section">
                <div class="keyword-input-wrapper">
                    <div class="keyword-header-row">
                        <label for="keywordInput">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            Search Keywords
                        </label>
                        <div class="match-mode-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" id="exactMatchToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="toggle-labels">
                                <span class="toggle-label active" id="exactLabel">Exact Match</span>
                                <span class="toggle-label" id="fuzzyLabel">Fuzzy Match</span>
                            </div>
                            <div class="match-mode-info" id="matchModeInfo">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                </svg>
                                <div class="info-tooltip">
                                    <strong>Exact Match:</strong> Matches plurals, possessives, compounds (e.g., "immigrant" → "immigrants", "pro-immigrant")
                                    <br><br>
                                    <strong>Fuzzy Match:</strong> Also catches typos and transcription errors (e.g., "Zelensky" → "Zelenskii")
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="keyword-input-row">
                        <input
                            type="text"
                            id="keywordInput"
                            placeholder="Enter keywords separated by commas (e.g., touchdown, quarterback, interception)"
                            class="keyword-input"
                        >
                        <button class="btn-search" id="searchBtn">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            Search
                        </button>
                    </div>
                    <div class="speaker-filter-section" id="speakerFilterSection" style="display: none;">
                        <label class="speaker-filter-label">Filter by Speaker:</label>
                        <div class="speaker-filter-options" id="speakerFilterOptions"></div>
                    </div>
                    <div class="keyword-stats" id="keywordStats"></div>
                </div>
            </div>

            <!-- Main Content Layout -->
            <div class="main-content-layout">
                <!-- Left Column: Video and Transcript -->
                <div class="left-column">
                    <!-- Video and Transcript Container -->
                    <div class="video-transcript-container">
                        <!-- Video Player -->
                        <div class="video-player-section" id="videoPlayerSection" style="display: none;">
                            <video id="videoPlayer" controls></video>
                        </div>

                        <!-- Transcript Content -->
                        <div class="transcript-content" id="transcriptContent"></div>
                    </div>
                </div>

                <!-- Right Column: Keyword Results Table -->
                <div class="right-column">
                    <div class="keyword-results-section" id="keywordResultsSection" style="display: none;">
                        <div class="keyword-results-header">
                            <h3>Keyword Search Results</h3>
                            <button class="btn-close" id="closeResultsBtn">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="keyword-results-table-wrapper">
                            <table class="keyword-results-table">
                                <thead>
                                    <tr>
                                        <th>Keyword</th>
                                        <th>Status</th>
                                        <th>Count</th>
                                    </tr>
                                </thead>
                                <tbody id="keywordResultsTableBody"></tbody>
                            </table>
                        </div>
                        <div class="keyword-occurrences" id="keywordOccurrences" style="display: none;">
                            <div class="occurrences-header">
                                <h4 id="occurrencesTitle">Occurrences</h4>
                                <button class="btn-close-small" id="closeOccurrencesBtn">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="occurrences-list" id="occurrencesList"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Word Frequency Analytics Section -->
            <div class="analytics-section" id="analyticsSection" style="display: none;">
                <div class="analytics-header">
                    <h3>📊 Word Frequency Analysis</h3>
                    <p class="analytics-subtitle">Most frequently used words (excluding common words)</p>
                </div>
                <div class="word-frequency-chart" id="wordFrequencyChart"></div>
            </div>
        </div>

        <!-- Error Section -->
        <div class="error-section" id="errorSection" style="display: none;">
            <div class="error-content">
                <svg class="error-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h3>Transcription Failed</h3>
                <p id="errorMessage"></p>
                <button class="btn-primary" id="retryBtn">Try Again</button>
            </div>
        </div>
    </div>

    <!-- ElevenLabs Conversational AI Widget -->
    <elevenlabs-convai
        agent-id="agent_3701k7dpyg01eq8raj2crxfhn290"
        text-only="true">
    </elevenlabs-convai>

    <script src="matching.js"></script>
    <script src="app.js"></script>
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>
</body>
</html>
